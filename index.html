<!doctype html>
<html lang="fi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#0b0b0f" />
  <title>Ruokasi</title>
  <link rel="manifest" href="manifest.json?v=20260206184824">
  <link rel="icon" href="icon.png">
  <link rel="apple-touch-icon" href="icon.png">
  <link rel="stylesheet" href="style.css?v=20260206184824">
</head>
<body>
  <div id="__err_overlay" style="display:none;position:fixed;inset:12px 12px auto 12px;background:rgba(220,38,38,.18);border:1px solid rgba(220,38,38,.55);color:#fff;padding:12px;border-radius:14px;font-family:system-ui,-apple-system;font-size:13px;line-height:1.25;z-index:99999;white-space:pre-wrap"></div>

  <div class="container">
    <div class="topbar">
      <div class="brand">
        <div class="appicon"></div>
        <div style="min-width:0">
          <div style="display:flex;align-items:center;gap:10px;min-width:0">
            <h1 style="min-width:0;overflow:visible">Ruokasi</h1>
</div>
          <div class="subline"><span id="versionBadge" class="version">v</span></div>
        </div>
      </div>
      <div class="actions">
        <button id="calendarBtn" class="btn iconbtn" aria-label="Kalenteri">ðŸ“…</button>
        <button id="statusBtn" class="btn ok">OK</button>
        <button id="resetBtn" class="btn">Nollaa</button>
      </div>
    </div>

    <div class="card">
      <div class="inner">
        <div class="dateRow">
          <div><span id="todayLabel">TÃ¤nÃ¤Ã¤n</span> â€¢ <span id="dateLabel">â€”</span></div>
          <div id="pastHint" style="display:none;color:rgba(255,255,255,0.75)">Menneisyys</div>
        </div>

        <div class="summaryRow" style="margin-top:10px">
          <div class="ringWrap">
            <svg viewBox="0 0 120 120">
              <circle cx="60" cy="60" r="46" stroke="rgba(255,255,255,0.12)" stroke-width="12" fill="none"></circle>
              <g id="ringSegs"></g>
              <circle id="ringArc" cx="60" cy="60" r="46" stroke="var(--accent)" stroke-width="12" fill="none"
                stroke-linecap="round" stroke-dasharray="0 999"></circle>
            </svg>
            <div class="ringCenter">
              <div class="num"><span id="eatenKcal">0</span></div>
              <div class="small">kcal</div>
            </div>
          </div>
          <div>
            <div class="remaining">JÃ¤ljellÃ¤ <b><span id="remainingKcal">0</span> kcal</b></div>
            <a id="dayMealsLink" class="link" href="javascript:void(0)">PÃ¤ivÃ¤n syÃ¶miset</a>
          </div>
        </div>

        
        <div class="grid3" id="kpiRow">
          <div class="kpi" id="goalKpi" style="cursor:pointer">
            <div class="label">PÃ¤ivÃ¤n tavoite</div>
            <div class="value"><span id="targetKcal">0</span><span class="unit">kcal</span></div>
          </div>

          <div class="kpi" id="recKpi" style="cursor:pointer">
            <div class="label">Suositus</div>
            <div class="value"><span id="recKpiMeal">â€”</span></div>
            <div class="sub"><span id="recKpiKcal">â€”</span> kcal</div>
          </div>
</div>

        <div class="macro">

          <div class="row"><div>Proteiini</div><div><span id="pNow">0</span> / <span id="pGoal">0</span> g</div></div>
          <div class="bar"><div id="pFill" class="fill" style="background: var(--accent)"></div></div>
        </div>
        <div class="macro">
          <div class="row"><div>Hiilarit</div><div><span id="cNow">0</span> / <span id="cGoal">0</span> g</div></div>
          <div class="bar"><div id="cFill" class="fill" style="background: var(--accent)"></div></div>
        </div>
        <div class="macro">
          <div class="row"><div>Rasva</div><div><span id="fNow">0</span> / <span id="fGoal">0</span> g</div></div>
          <div class="bar"><div id="fFill" class="fill" style="background: var(--accent)"></div></div>
        </div>
      </div>
    </div>

    <div class="section card">
      <h3>LisÃ¤Ã¤ ruokaa</h3>
      <div class="body">
        <div class="pills" id="mealPills"></div>
        <div id="productHint" style="margin-top:12px;color:var(--muted)">Valitse tuote listalta.</div>
        <div class="list" id="productList"></div>
        <div style="margin-top:12px">
          <div style="display:flex;gap:8px;align-items:center"><button id="addProductBtn" class="btn">+ LisÃ¤Ã¤ tuote</button><button id="recipeBtn" class="btn iconbtn" title="Tee resepti">â–¾</button></div>
        </div>
      </div>
    </div>

    <div class="section card">
      <h3>Suositus</h3>
      <div class="body">
        <div class="pills" id="planPills"></div>
        <div style="margin-top:10px;display:flex;gap:10px;align-items:center">
          <button id="refreshRecBtn" class="btn primary">PÃ¤ivitÃ¤</button>
          <div id="recStatus" style="color:var(--muted)">â€”</div>
        </div>
        <div id="recCard" class="list" style="margin-top:12px"></div>
      </div>
    </div>
  </div>

  
  <div id="recipeModal" class="modal" aria-hidden="true">
    <div class="sheet">
      <div class="hdr">
        <button class="btn danger iconbtn" id="recipeClose">âœ•</button>
        <h4>Tee resepti</h4>
        <div style="width:48px"></div>
      </div>
      <div class="content">
        <div class="field">
          <label>Nimi</label>
          <input id="recipeName" class="input" placeholder="esim. Kaurapuuro" />
        </div>
        <div class="field">
          <label>Kategoria</label>
          <select id="recipeCat" class="input"></select>
        </div>

        <div style="margin-top:10px" class="muted">Ainekset</div>
        <div id="recipeItems" class="list" style="margin-top:8px"></div>
        <div style="margin-top:10px;display:flex;gap:10px">
          <button id="recipeAddItem" class="btn">+ LisÃ¤Ã¤ aines</button>
        </div>

        <div class="card" style="margin-top:12px">
          <div class="body" style="display:flex;justify-content:space-between;gap:12px">
            <div><div class="muted">Kalorit</div><div><b><span id="recipeTotKcal">0</span></b> kcal</div></div>
            <div><div class="muted">P</div><div><b><span id="recipeTotP">0</span></b> g</div></div>
            <div><div class="muted">C</div><div><b><span id="recipeTotC">0</span></b> g</div></div>
            <div><div class="muted">F</div><div><b><span id="recipeTotF">0</span></b> g</div></div>
          </div>
        </div>

        <div style="margin-top:14px;display:flex;gap:10px;justify-content:space-between">
          <button id="recipeSave" class="btn ok" style="flex:1">V</button>
          <button id="recipeCancel" class="btn danger" style="flex:1">X</button>
        </div>
      </div>
    </div>
  </div>


<!-- Modals (same ids app.js expects) -->
  <div id="goalModal" class="modal" aria-hidden="true">
    <div class="sheet">
      <div class="hdr">
        <button class="btn danger iconbtn" id="goalCancel">âœ•</button>
        <h4>PÃ¤ivÃ¤n tavoite</h4>
        <button class="btn ok iconbtn" id="goalSave">âœ“</button>
      </div>
      <div class="content">
        <div class="row2">
          <div class="field"><label>Perustavoite (kcal)</label><input id="baseKcal" type="number" inputmode="numeric" /></div>
          <div class="field"><label>Treenikcal (+)</label><input id="workoutKcal" type="number" inputmode="numeric" /></div>
        </div>
        <div class="row2">
          <div class="field"><label>Askelten tavoite (kpl)</label><input id="stepGoal" type="number" inputmode="numeric" /></div>
          <div class="field"><label>Uni (h)</label><input id="sleepH" type="number" inputmode="decimal" /></div>
        </div>
        <div class="field"><label>Laskettu pÃ¤ivÃ¤n tavoite</label><input id="computedTarget" type="text" disabled /></div>
        <div class="row3">
          <div class="field"><label>Proteiini (g)</label><input id="goalP" type="number" inputmode="numeric" /></div>
          <div class="field"><label>Hiilarit (g)</label><input id="goalC" type="number" inputmode="numeric" /></div>
          <div class="field"><label>Rasva (g)</label><input id="goalF" type="number" inputmode="numeric" /></div>
        </div>
      </div>
    </div>
  </div>

  <div id="productModal" class="modal" aria-hidden="true">
    <div class="sheet">
      <div class="hdr">
        <button class="btn danger iconbtn" id="prodCancel">âœ•</button>
        <h4 id="prodTitle">LisÃ¤Ã¤ tuote</h4>
        <button class="btn ok iconbtn" id="prodSave">âœ“</button>
      </div>
      <div class="content">
        <div class="field"><label>Nimi</label><input id="prodName" type="text" /></div>
        <div class="row2">
          <div class="field"><label>Kategoria</label><select id="prodCat"></select></div>
          <div class="field"><label>YksikkÃ¶</label><select id="prodUnit"></select></div>
        </div>
        <div class="row2">
          <div class="field"><label>g / yksikkÃ¶</label><input id="prodGPer" type="number" inputmode="decimal" /></div>
          <div class="field"><label>Kalorit / 100g</label><input id="prodKcal100" type="number" inputmode="decimal" /></div>
        </div>
        <div class="row3">
          <div class="field"><label>Proteiini / 100g</label><input id="prodP100" type="number" inputmode="decimal" /></div>
          <div class="field"><label>Hiilarit / 100g</label><input id="prodC100" type="number" inputmode="decimal" /></div>
          <div class="field"><label>Rasva / 100g</label><input id="prodF100" type="number" inputmode="decimal" /></div>
        </div>
        <div class="field"><label>EAN (valinnainen)</label><input id="prodEan" type="text" inputmode="numeric" /></div>

        <div class="card" style="margin-top:12px;background:rgba(0,0,0,0.18)">
          <div class="inner" style="padding:12px 12px 14px">
            <div style="display:flex;align-items:center;justify-content:space-between;gap:10px">
              <div style="font-weight:850">Hae Open Food Facts</div>
              <button id="offSearchBtn" class="btn primary">Hae</button>
            </div>
            <div class="field" style="margin-top:10px"><input id="offQuery" type="text" placeholder="esim. kanafile, maitorahka, kahvi" /></div>
            <div id="offStatus" style="color:var(--muted);margin-top:6px">â€”</div>
            <div id="offResults" class="list" style="margin-top:10px"></div>
          </div>
        </div>

        <div id="prodDeleteWrap" style="margin-top:12px;display:none">
          <button id="prodDelete" class="btn danger">ðŸ—‘ Poista tuote</button>
        </div>
      </div>
    </div>
  </div>

  <div id="qtyModal" class="modal" aria-hidden="true">
    <div class="sheet">
      <div class="hdr">
        <button class="btn danger iconbtn" id="qtyCancel">âœ•</button>
        <h4 id="qtyTitle">â€”</h4>
        <button class="btn ok iconbtn" id="qtyConfirm">âœ“</button>
      </div>
      <div class="content">
        <div id="qtyMeta" style="color:var(--muted);font-weight:700">â€”</div>
        <div style="margin-top:12px;display:flex;gap:10px;align-items:center">
          <button id="qtyMinus" class="btn iconbtn">âˆ’</button>
          <input id="qtyValue" type="number" inputmode="decimal" />
          <button id="qtyPlus" class="btn iconbtn">+</button>
        </div>
        <div style="margin-top:14px">
          <button id="qtyDelete" class="btn danger" style="display:none" title="Poista tÃ¤stÃ¤ pÃ¤ivÃ¤stÃ¤" aria-label="Poista tÃ¤stÃ¤ pÃ¤ivÃ¤stÃ¤">ðŸ—‘</button>
        </div>
      </div>
    </div>
  </div>

  <div id="mealsModal" class="modal" aria-hidden="true">
    <div class="sheet">
      <div class="hdr">
        <button class="btn danger iconbtn" id="mealsClose">âœ•</button>
        <h4>PÃ¤ivÃ¤n syÃ¶miset</h4>
        <div style="width:48px"></div>
      </div>
      <div class="content"><div id="mealsContent" class="list"></div></div>
    </div>
  </div>

  <div id="breakdownModal" class="modal" aria-hidden="true">
    <div class="sheet">
      <div class="hdr">
        <button class="btn danger iconbtn" id="bdClose">âœ•</button>
        <h4 id="bdTitle">Erittele</h4>
        <div style="width:48px"></div>
      </div>
      <div class="content">
        <div class="row" style="gap:8px; flex-wrap:wrap; margin-bottom:10px">
          <button class="btn pill" id="bdTabKcal">kcal</button>
          <button class="btn pill" id="bdTabP">P</button>
          <button class="btn pill" id="bdTabC">H</button>
          <button class="btn pill" id="bdTabF">R</button>
        </div>
        <div id="bdList" class="list"></div>
      </div>
    </div>
  </div>

  <div id="calendarModal" class="modal" aria-hidden="true">
    <div class="sheet">
      <div class="hdr">
        <button class="btn danger iconbtn" id="calClose">âœ•</button>
        <h4>Valitse pÃ¤ivÃ¤</h4>
        <div style="width:48px"></div>
      </div>
      <div class="content">
        <div class="field"><label>PÃ¤ivÃ¤mÃ¤Ã¤rÃ¤</label><input id="calDate" type="date" /></div>
        <button id="calGo" class="btn primary" style="margin-top:12px;width:100%">Avaa</button>
      </div>
    </div>
  </div>

  <div id="toast" class="toast">LisÃ¤tty</div>

  <script>
    (function() {
      const box = document.getElementById("__err_overlay");
      function show(msg){ box.style.display="block"; box.textContent="Ruokasi: JavaScript-virhe\\n"+msg; }
      window.addEventListener("error", function(e){
        try{
          const msg=(e&&e.message)?e.message:"Tuntematon virhe";
          const src=(e&&e.filename)?("\\n"+e.filename+":"+(e.lineno||0)+":"+(e.colno||0)):"";
          show(msg+src);
        }catch(_){}
      });
      window.addEventListener("unhandledrejection", function(e){
        try{ show("Promise-virhe: "+(e&&e.reason?String(e.reason):"tuntematon")); }catch(_){}
      });
    })();
  </script>

  <script src="app.js?v=20260206184824" defer></script>
</body>
</html>
