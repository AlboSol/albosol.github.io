<!doctype html>
<html lang="fi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Ruokasi</title>
  <link rel="manifest" href="manifest.json?v=20260204231145" />
  <link rel="apple-touch-icon" href="icon.png" />
  <meta name="theme-color" content="#0A84FF" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="apple-mobile-web-app-title" content="Ruokasi" />
  <link rel="stylesheet" href="style.css?v=20260204231145" />
</head>
<body>
  <header class="nav">
    <div class="nav__title">
      <div class="appmark" aria-hidden="true"></div>
      <div>
        <h1>Ruokasi</h1>
      <div class="badge" id="versionBadge">–</div>
        <p class="sub">1900–2000 kcal / päivä • v3.2.4.6</p>
      </div>
    </div>
    <button class="ghost" id="btnReset" title="Nollaa päivä">Nollaa</button>
  </header>

  <main class="container">

    <section class="card">
      <div class="row">
        <div>
          <h2>Tänään</h2>
          <p class="muted" id="todayLabel">–</p>
        </div>
        <div class="pill" id="statusPill">OK</div>
      </div>

      <div class="kpi-grid">
        <div class="kpi">
          <div class="kpi__label">Syöty</div>
          <div class="kpi__value"><span id="kcalEaten">0</span><span class="unit">kcal</span></div>
        </div>
        <div class="kpi">
          <div class="kpi__label">Jäljellä</div>
          <div class="kpi__value"><span id="kcalLeft">0</span><span class="unit">kcal</span></div>
        </div>
        <div class="kpi">
          <div class="kpi__label">Arvioitu kulutus</div>
          <div class="kpi__value"><span id="kcalBurn">0</span><span class="unit">kcal</span></div>
        </div>
      </div>

      <div class="macro-grid">
        <div class="macro">
          <div class="macro__top">
            <span>Proteiini</span><span class="muted"><span id="pNow">0</span> / <span id="pGoal">140</span> g</span>
          </div>
          <div class="bar"><div class="bar__fill" id="pBar"></div></div>
        </div>
        <div class="macro">
          <div class="macro__top">
            <span>Hiilarit</span><span class="muted"><span id="cNow">0</span> / <span id="cGoal">170</span> g</span>
          </div>
          <div class="bar"><div class="bar__fill" id="cBar"></div></div>
        </div>
        <div class="macro">
          <div class="macro__top">
            <span>Rasva</span><span class="muted"><span id="fNow">0</span> / <span id="fGoal">70</span> g</span>
          </div>
          <div class="bar"><div class="bar__fill" id="fBar"></div></div>
        </div>
      </div>

      <details class="details">
        <summary>Lisäasetukset</summary>
        <div class="form-grid">
          <label>Kaloritavoite (max)<input type="number" id="goalMax" value="2000" /></label>
          <label>Kaloritavoite (min)<input type="number" id="goalMin" value="1900" /></label>
          <label>Proteiinitavoite (g)<input type="number" id="goalP" value="140" /></label>
          <label>Hiilaritavoite (g)<input type="number" id="goalC" value="170" /></label>
          <label>Rasvatavoite (g)<input type="number" id="goalF" value="70" /></label>
          <label>Askeleet tänään<input type="number" id="steps" value="0" /></label>
          <label>Treeni (kcal)<input type="number" id="workoutKcal" value="0" /></label>
          <label>Uni (tunnit)<input type="number" id="sleepH" value="0" /></label>
        </div>
        <p class="hint">Askeleet arvioidaan ~0.04 kcal/askel. (Watch/uni automaattisesti vaatii natiivin iOS-sovelluksen.)</p>
      </details>
    </section>

    <details class="card carddet" open id="secAdd">
      <summary class="cardSum">Lisää ruokaa</summary>
      <div class="row">
        <div class="seg">
          <button class="seg__btn is-on" data-meal="aamiainen">Aamiainen</button>
          <button class="seg__btn" data-meal="lounas">Lounas</button>
          <button class="seg__btn" data-meal="välipala">Välipala</button>
          <button class="seg__btn" data-meal="päivällinen">Päivällinen</button>
          <button class="seg__btn" data-meal="iltapala">Iltapala</button>
        </div>
      </div>
      <div class="tabhint" id="mealHint">Valitse vaihtoehdot ja säädä annoskoot (yksiköt + grammat).</div>
      <div id="presetList" class="list"></div>
      <div class="row row--tight">
        <button class="primary" id="btnAddSelected">Lisää valitut</button>
        <button class="ghost" id="btnClearSelected">Tyhjennä valinnat</button>
      </div>
    </details>

    <details class="card carddet" open id="secCustom">
      <summary class="cardSum">Omat ruoat</summary>
      <div class="row">
        <div class="muted">Lisää omia ruokia, joille määritetään myös yksikkö + grammat.</div>
        <button class="ghost" id="btnOpenCustom" onclick="window.RUOKASI_OPEN_CUSTOM&&window.RUOKASI_OPEN_CUSTOM()">Lisää oma</button>
      </div>
      <div id="customList" class="list"></div>
    </details>

    <details class="card carddet" open id="secLog">
      <summary class="cardSum">Päivän syömiset</summary>
      <div class="row">
        <div class="muted">Kirjaukset tälle päivälle.</div>
        <button class="ghost" id="btnExport">Vie</button>
      </div>
      <div id="logList" class="log"></div>
    </details>

    <details class="card carddet" open id="secSuggest">
      <summary class="cardSum">Suositus</summary>
      <div class="muted">Suositus tasapainottaa päivän makroja. Poista ateria täpällä, jos haluat.</div>
      <div class="mealplan" id="mealPlan"></div>
      <div class="row row--tight" style="margin-top:10px">
        <button class="ghost" id="btnSuggest">Päivitä</button>
        <div class="muted" id="suggestUpdated" style="margin-left:auto">–</div>
      </div>
      <div class="suggest" id="suggestBox">–</div>
    </details>

  </main>

  <div class="modalOverlay is-hidden" id="customModal" role="dialog" aria-modal="true" aria-labelledby="customTitle">
    <div class="modal">
      <div class="modal__head">
        <h3 id="customTitle">Lisää oma ruoka</h3>
        <button class="ghost" type="button" id="btnCloseCustom" aria-label="Sulje">✕</button>
      </div>

      <details class="details" style="margin-top:10px">
        <summary>Hae Open Food Factsista</summary>
        <div class="form-grid" style="margin-top:10px">
          <label>Haku (tuotenimi tai viivakoodi)
            <input id="offQuery" placeholder="esim. Valio PROfeel / 6408432101234" />
          </label>
        </div>
        <div class="row row--tight" style="margin-top:10px">
          <button class="ghost" type="button" id="btnOffSearch" onclick="window.RUOKASI_OFF_SEARCH&&window.RUOKASI_OFF_SEARCH()">Hae</button>
          <div class="muted" id="offStatus" style="margin-left:auto">–</div>
        </div>
        <div id="offResults" class="list" style="margin-top:10px"></div>
        <p class="hint">Lähde: Open Food Facts (avoin tietokanta). Tarkista arvot, jos tiedoissa on puutteita.</p>
      </details>

      <div class="form-grid" style="margin-top:12px">
        <label>Nimi<input id="cfName" /></label>
        <label>Kalorit / 100g<input id="cfKcal" type="number" /></label>
        <label>Proteiini / 100g<input id="cfP" type="number" /></label>
        <label>Hiilarit / 100g<input id="cfC" type="number" /></label>
        <label>Rasva / 100g<input id="cfF" type="number" /></label>
        <label>Yksikkö<input id="cfUnit" placeholder="viipale, kpl, dl" /></label>
        <label>g / yksikkö<input id="cfGPU" type="number" placeholder="35" /></label>
      </div>

      <div class="row row--tight" style="margin-top:12px">
        <button class="primary" type="button" id="btnSaveCustom">Tallenna</button>
        <button class="ghost" type="button" id="btnCancelCustom">Peruuta</button>
      </div>
    </div>
  </div>

<script src="app.js?v=20260204231145"></script>

<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', async () => {
    try {
      const reg = await navigator.serviceWorker.register('sw.js?v=20260204231145', { scope: './' });
      try { reg.update(); } catch(_) {}
    } catch(e) {}
  });
}
</script>

</body>
</html>
