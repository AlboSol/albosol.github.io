<!doctype html>
<html lang="fi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Ruokasi – reset</title>
  <style>
    body { font-family: system-ui, -apple-system; padding: 20px; background:#0b0b0f; color:#fff; }
    .card { background: rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12); border-radius: 14px; padding: 16px; }
    code { background: rgba(0,0,0,.25); padding:2px 6px; border-radius:8px; }
  </style>
</head>
<body>
  <div class="card">
    <h2>Ruokasi – nollaus</h2>
    <p>Poistan vanhat välimuistit ja Service Worker -asennukset. Hetken kuluttua palaan sovellukseen.</p>
    <p><code>build 20260204221201</code></p>
    <div id="status">Käynnistetään…</div>
  </div>

  <script>
    (async function() {
      const el = document.getElementById('status');
      try {
        el.textContent = "Poistetaan service workerit…";
        if ('serviceWorker' in navigator) {
          const regs = await navigator.serviceWorker.getRegistrations();
          for (const r of regs) {
            try { await r.unregister(); } catch(e) {}
          }
        }
        el.textContent = "Poistetaan välimuistit…";
        if ('caches' in window) {
          const keys = await caches.keys();
          for (const k of keys) {
            try { await caches.delete(k); } catch(e) {}
          }
        }
        el.textContent = "Valmis. Avataan Ruokasi…";
      } catch (e) {
        el.textContent = "Nollaus epäonnistui: " + (e && e.message ? e.message : e);
      }
      setTimeout(() => {
        location.href = "/?v=20260204221201";
      }, 800);
    })();
  </script>
</body>
</html>
